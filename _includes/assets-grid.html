{%- comment -%} Folder-driven gallery with layout + fit options (GitHub Pages safe) {%- endcomment -%}

{%- assign folder      = include.folder    | default: page.assets -%}
{%- assign layout      = include.layout    | default: "uniform" -%}   {# "uniform" | "masonry" #}
{%- assign ratio       = include.ratio     | default: "4/3" -%}       {# used in uniform mode #}
{%- assign fit         = include.fit       | default: "cover" -%}     {# "cover" | "contain"   #}
{%- assign show_caps   = include.captions  | default: false -%}
{%- assign link_full   = include.link_full | default: false -%}

{%- if folder == nil or folder == "" -%}
  <p><em>Missing <code>assets</code> folder path (set in page front matter or pass as include param).</em></p>
{%- endif -%}
{%- assign folder = folder | append: "/" | replace: "//","/" -%}

{%- assign count = 0 -%}
<ul class="gallery-grid {{ layout }}">
  {%- for f in site.static_files | sort: "name" -%}
    {%- assign p = f.path -%}
    {%- assign ext = f.extname | downcase -%}
    {%- if p contains folder and (ext==".svg" or ext==".png" or ext==".jpg" or ext==".jpeg" or ext==".webp") -%}
      {%- assign count = count | plus: 1 -%}
      {%- assign base = f.name | split: "." | first -%}
      {%- assign title_from_name = base | split: "_" | last | replace: "-", " " -%}
      <li class="gallery-item">
        {%- if link_full -%}<a href="{{ p | relative_url }}" target="_blank" rel="noopener">{%- endif -%}
          <img
            src="{{ p | relative_url }}"
            alt="{{ title_from_name | escape }}"
            loading="lazy" decoding="async"
            style="--ratio: {{ ratio }}; --fit: {{ fit }};">
        {%- if link_full -%}</a>{%- endif -%}
        {%- if show_caps -%}<figcaption class="gallery-caption">{{ title_from_name }}</figcaption>{%- endif -%}
      </li>
    {%- endif -%}
  {%- endfor -%}
</ul>

{%- if count == 0 -%}
  <p>No images found in <code>{{ folder }}</code>.</p>
{%- endif -%}

<style>
  .gallery-grid{ list-style:none; padding:0; margin:1rem 0 0; }
  .gallery-item{
    border:1px solid color-mix(in oklab, currentColor 12%, transparent);
    border-radius:12px; overflow:hidden;
    background: color-mix(in oklab, Canvas 98%, currentColor 2%);
  }
  .gallery-caption{ padding:.6rem .8rem; font-size:.95rem; opacity:.8; }

  /* Uniform mode: equal-height tiles via aspect-ratio */
  .gallery-grid.uniform{
    display:grid; gap:1rem;
    grid-template-columns: repeat(auto-fit, minmax(240px,1fr));
  }
  .gallery-grid.uniform img{
    width:100%;
    aspect-ratio: var(--ratio, 4/3);   /* e.g., 4/3, 3/4, 1/1, 2/3 */
    object-fit: var(--fit, cover);     /* cover = crop; contain = letterbox */
    display:block;
    background: color-mix(in oklab, Canvas 96%, currentColor 4%); /* pleasant letterbox for 'contain' */
  }

  /* Masonry mode: no cropping, variable heights */
  .gallery-grid.masonry{ column-width: 320px; column-gap: 1rem; }
  @media (max-width: 960px){ .gallery-grid.masonry{ column-width: 280px; } }
  @media (max-width: 640px){ .gallery-grid.masonry{ column-width: 220px; } }
  .gallery-grid.masonry .gallery-item{
    break-inside: avoid; display:inline-block; width:100%; margin:0 0 1rem;
  }
  .gallery-grid.masonry img{ width:100%; height:auto; display:block; }
</style>
